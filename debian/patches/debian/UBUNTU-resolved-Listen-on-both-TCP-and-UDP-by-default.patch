From: Dimitri John Ledkov <xnox@ubuntu.com>
Date: Fri, 6 Apr 2018 14:53:39 +0100
Subject: UBUNTU resolved: Listen on both TCP and UDP by default.

LP: #1731522
---
 man/resolved.conf.xml          | 4 ++--
 src/resolve/resolved-manager.c | 2 +-
 src/resolve/resolved.conf.in   | 2 +-
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/man/resolved.conf.xml b/man/resolved.conf.xml
index c36c303..613b11a 100644
--- a/man/resolved.conf.xml
+++ b/man/resolved.conf.xml
@@ -239,9 +239,9 @@
       <varlistentry>
         <term><varname>DNSStubListener=</varname></term>
         <listitem><para>Takes a boolean argument or one of <literal>udp</literal> and <literal>tcp</literal>. If
-        <literal>udp</literal> (the default), a DNS stub resolver will listen for UDP requests on address 127.0.0.53
+        <literal>udp</literal>, a DNS stub resolver will listen for UDP requests on address 127.0.0.53
         port 53. If <literal>tcp</literal>, the stub will listen for TCP requests on the same address and port. If
-        <literal>yes</literal>, the stub listens for both UDP and TCP requests.  If <literal>no</literal>, the stub
+        <literal>yes</literal> (the default), the stub listens for both UDP and TCP requests.  If <literal>no</literal>, the stub
         listener is disabled.</para>
 
         <para>Note that the DNS stub listener is turned off implicitly when its listening address and port are already
diff --git a/src/resolve/resolved-manager.c b/src/resolve/resolved-manager.c
index d47f502..228ffc0 100644
--- a/src/resolve/resolved-manager.c
+++ b/src/resolve/resolved-manager.c
@@ -577,7 +577,7 @@ int manager_new(Manager **ret) {
         m->dnssec_mode = DEFAULT_DNSSEC_MODE;
         m->dns_over_tls_mode = DEFAULT_DNS_OVER_TLS_MODE;
         m->enable_cache = true;
-        m->dns_stub_listener_mode = DNS_STUB_LISTENER_UDP;
+        m->dns_stub_listener_mode = DNS_STUB_LISTENER_YES;
         m->read_resolv_conf = true;
         m->need_builtin_fallbacks = true;
         m->etc_hosts_last = m->etc_hosts_mtime = USEC_INFINITY;
diff --git a/src/resolve/resolved.conf.in b/src/resolve/resolved.conf.in
index 50601d6..7bb3a10 100644
--- a/src/resolve/resolved.conf.in
+++ b/src/resolve/resolved.conf.in
@@ -20,4 +20,4 @@
 #DNSSEC=@DEFAULT_DNSSEC_MODE@
 #DNSOverTLS=@DEFAULT_DNS_OVER_TLS_MODE@
 #Cache=yes
-#DNSStubListener=udp
+#DNSStubListener=yes
