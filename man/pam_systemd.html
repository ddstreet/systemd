<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>pam_systemd</title><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"/></head><body><div class="refentry" title="pam_systemd"><a id="pam_systemd"/><div class="titlepage"/><div class="refnamediv"><h2>Name</h2><p>pam_systemd â€” Register user sessions in the systemd control group hierarchy</p></div><div class="refsynopsisdiv" title="Synopsis"><h2>Synopsis</h2><div class="cmdsynopsis"><p><code class="command">pam_systemd.so</code> </p></div></div><div class="refsect1" title="Description"><a id="id344647"/><h2>Description</h2><p><span class="command"><strong>pam_systemd</strong></span> registers user
                sessions in the systemd control group
                hierarchy.</p><p>On login, this module ensures the following:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>If it does not exist yet, the
                        user runtime directory
                        <code class="filename">/var/run/user/$USER</code> is
                        created and its ownership changed to the user
                        that is logging in.</p></li><li class="listitem"><p>If
                        <code class="option">create-session=1</code> is set, the
                        <code class="varname">$XDG_SESSION_ID</code> environment
                        variable is initialized. If auditing is
                        available and
                        <span class="command"><strong>pam_loginuid.so</strong></span> run before
                        this module (which is highly recommended), the
                        variable is initialized from the auditing
                        session id
                        (<code class="filename">/proc/self/sessionid</code>). Otherwise
                        an independent session counter is
                        used.</p></li><li class="listitem"><p>If
                        <code class="option">create-session=1</code> is set, a new
                        control group
                        <code class="filename">/user/$USER/$XDG_SESSION_ID</code>
                        is created and the login process moved into
                        it.</p></li><li class="listitem"><p>If
                        <code class="option">create-session=0</code> is set, a new
                        control group
                        <code class="filename">/user/$USER/user</code>
                        is created and the login process moved into
                        it.</p></li></ol></div><p>On logout, this module ensures the following:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>If
                        <code class="varname">$XDG_SESSION_ID</code> is set and
                        <code class="option">kill-session=1</code> specified, all
                        remaining processes in the
                        <code class="filename">/user/$USER/$XDG_SESSION_ID</code>
                        control group are killed and the control group
                        is removed.</p></li><li class="listitem"><p>If
                        <code class="varname">$XDG_SESSION_ID</code> is set and
                        <code class="option">kill-session=0</code> specified, all
                        remaining processes in the
                        <code class="filename">/user/$USER/$XDG_SESSION_ID</code>
                        control group are migrated to
                        <code class="filename">/user/$USER/user</code> and
                        the original control group is
                        removed.</p></li><li class="listitem"><p>If
                        <code class="option">kill-user=1</code> is specified, and
                        no other user session control group remains,
                        except
                        <code class="filename">/user/$USER/user</code>,
                        all remaining processes in the
                        <code class="filename">/user/$USER</code> hierarchy
                        are killed and the control group is removed.</p></li><li class="listitem"><p>If
                        <code class="option">kill-user=0</code> is specified, and
                        no process remains in the
                        <code class="filename">/user/$USER</code> hierarchy the
                        control group is removed.</p></li><li class="listitem"><p>If the
                        <code class="filename">/user/$USER</code> control group
                        was removed the
                        <code class="varname">$XDG_RUNTIME_DIR</code> directory
                        and all its contents are
                        removed, too.</p></li></ol></div><p>If the system was not booted up with systemd as
                init system, this module does nothing and immediately
                returns PAM_SUCCESS.</p></div><div class="refsect1" title="Options"><a id="id312221"/><h2>Options</h2><p>The following options are understood:</p><div class="variablelist"><dl><dt><span class="term"><code class="option">create-session=</code></span></dt><dd><p>Takes a boolean
                                argument. If true, a new session is
                                created: the
                                <code class="varname">$XDG_SESSION_ID</code>
                                environment variable is set and the
                                login process moved to the
                                <code class="filename">/user/$USER/$XDG_SESSION_ID</code>
                                control group. It is recommended that
                                all services which are directly created
                                on the user's behalf set this
                                option. Only for services that shall
                                automatically be terminated when the
                                user logs out completely, otherwise
                                <code class="varname">create-session=0</code>
                                should be set.</p></dd><dt><span class="term"><code class="option">kill-session=</code></span></dt><dd><p>Takes a boolean
                                argument. If true, all processes
                                created by the user during his session
                                and from his session will be
                                terminated when he logs out from his
                                session.</p></dd><dt><span class="term"><code class="option">kill-user=</code></span></dt><dd><p>Takes a boolean
                                argument. If true, all processes
                                created by the user during his session
                                and from his session will be
                                terminated after he logged out
                                completely. This is a weaker version
                                of <code class="option">kill-session=1</code> and is
                                more friendly for users logged in more
                                than once, as their processes are
                                terminated only on their complete
                                logout.</p></dd><dt><span class="term"><code class="option">kill-only-users=</code></span></dt><dd><p>Takes a comma
                                separated list of user names or
                                numeric user ids as argument. If this
                                option is used the effect of the
                                <code class="option">kill-session=</code> and
                                <code class="option">kill-user=</code> options
                                will apply only to the listed
                                users. If this option is not used the
                                option applies to all local
                                users. Note that
                                <code class="option">kill-exclude-users=</code>
                                takes precedence over this list and is
                                hence subtracted from the list
                                specified here.</p></dd><dt><span class="term"><code class="option">kill-exclude-users=</code></span></dt><dd><p>Takes a comma
                                separated list of user names or
                                numeric user ids as argument. Users
                                listed in this argument will not be
                                subject to the effect of
                                <code class="option">kill-session=</code> or
                                <code class="option">kill-user=</code>.  Note
                                that that this option takes precedence
                                over
                                <code class="option">kill-only-users=</code>, and
                                hence whatever is listed for
                                <code class="option">kill-exclude-users=</code>
                                is guaranteed to never be killed by
                                this PAM module, independent of any
                                other configuration
                                setting.</p></dd><dt><span class="term"><code class="option">controllers=</code></span></dt><dd><p>Takes a comma
                                separated list of cgroup controllers
                                in which hierarchies a user/session
                                cgroup will be created by default for
                                each user logging in, in addition to
                                the cgroup in the named 'name=systemd'
                                hierarchy. If ommited, defaults to an
                                empty list. This may be used to move
                                user sessions into their own groups in
                                the 'cpu' hierarchy which ensures that
                                every logged in user gets an equal
                                amount of CPU time regardless how many
                                processes he has
                                started.</p></dd><dt><span class="term"><code class="option">reset-controllers=</code></span></dt><dd><p>Takes a comma
                                separated list of cgroup controllers
                                in which hierarchies the logged in
                                processes will be reset to the root
                                cgroup. If ommited, defaults to 'cpu',
                                meaning that a 'cpu' cgroup grouping
                                inherited from the login manager will
                                be reset for the processes of the
                                logged in user.</p></dd></dl></div><p>Note that setting <code class="varname">kill-user=1</code>
                or even <code class="varname">kill-session=1</code> will break
                tools like
                <span class="citerefentry"><span class="refentrytitle">screen</span>(1)</span>.</p><p>If the options are omitted they default to
                <code class="option">create-session=1</code>,
                <code class="option">kill-session=0</code>,
                <code class="option">kill-user=0</code>,
                <code class="option">keep-root=1</code>,
                <code class="option">reset-controllers=cpu</code>,
                <code class="option">kill-only-users=</code>,
                <code class="option">kill-exclude-users=root</code>.</p></div><div class="refsect1" title="Module Types Provided"><a id="id312519"/><h2>Module Types Provided</h2><p>Only <code class="option">session</code> is provided.</p></div><div class="refsect1" title="Environment"><a id="id353588"/><h2>Environment</h2><p>The following environment variables are set for the processes of the user's session:</p><div class="variablelist"><dl><dt><span class="term"><code class="varname">$XDG_SESSION_ID</code></span></dt><dd><p>A session identifier,
                                suitable to be used in file names. The
                                string itself should be considered
                                opaque, although often it is just the
                                audit session ID as reported by
                                <code class="filename">/proc/self/sessionid</code>. Each
                                ID will be assigned only once during
                                machine uptime. It may hence be used
                                to uniquely label files or other
                                resources of this
                                session.</p></dd><dt><span class="term"><code class="varname">$XDG_RUNTIME_DIR</code></span></dt><dd><p>Path to a user-private
                                user-writable directory that is bound
                                to the user login time on the
                                machine. It is automatically created
                                the first time a user logs in and
                                removed on his final logout. If a user
                                logs in twice at the same time, both
                                sessions will see the same
                                <code class="varname">$XDG_RUNTIME_DIR</code>
                                and the same contents. If a user logs
                                in once, then logs out again, and logs
                                in again, the directory contents will
                                have been lost in between, but
                                applications should not rely on this
                                behaviour and must be able to deal with
                                stale files. To store session-private
                                data in this directory the user should
                                include the value of <code class="varname">$XDG_SESSION_ID</code>
                                in the filename. This directory shall
                                be used for runtime file system
                                objects such as AF_UNIX sockets,
                                FIFOs, PID files and similar. It is
                                guaranteed that this directory is
                                local and offers the greatest possible
                                file system feature set the
                                operating system
                                provides.</p></dd></dl></div></div><div class="refsect1" title="Example"><a id="id353657"/><h2>Example</h2><pre class="programlisting">#%PAM-1.0
auth       required     pam_unix.so
auth       required     pam_nologin.so
account    required     pam_unix.so
password   required     pam_unix.so
session    required     pam_unix.so
session    required     pam_loginuid.so
session    required     pam_systemd.so kill-user=1</pre></div><div class="refsect1" title="See Also"><a id="id353671"/><h2>See Also</h2><p>
                        <span class="citerefentry"><span class="refentrytitle">pam.conf</span>(5)</span>,
                        <span class="citerefentry"><span class="refentrytitle">pam.d</span>(5)</span>,
                        <span class="citerefentry"><span class="refentrytitle">pam</span>(8)</span>,
                        <span class="citerefentry"><span class="refentrytitle">pam_loginuid</span>(8)</span>,
                        <span class="citerefentry"><span class="refentrytitle">systemd</span>(1)</span>
                </p></div></div></body></html>
