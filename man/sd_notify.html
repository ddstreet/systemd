<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>sd_notify</title><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"/></head><body><div class="refentry" title="sd_notify"><a id="sd_notify"/><div class="titlepage"/><div class="refnamediv"><h2>Name</h2><p>sd_notify, sd_notifyf — Notify init system about start-up completion and other daemon status changes</p></div><div class="refsynopsisdiv" title="Synopsis"><h2>Synopsis</h2><div class="funcsynopsis"><pre class="funcsynopsisinfo">#include "sd-daemon.h"</pre><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">int <strong>fsfuncsd_notify</strong>(</code></td><td>int <var class="pdparam">unset_environment</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">state</var><code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">int <strong>fsfuncsd_notifyf</strong>(</code></td><td>int <var class="pdparam">unset_environment</var>, </td></tr><tr><td> </td><td>const char *<var class="pdparam">format</var>, </td></tr><tr><td> </td><td>...<code>)</code>;</td></tr></table><div class="funcprototype-spacer"> </div></div></div><div class="refsect1" title="Description"><a id="id545512"/><h2>Description</h2><p><code class="function">sd_notify()</code> shall be called
                by a daemon to notify the init system about status
                changes. It can be used to send arbitrary information,
                encoded in an environment-block-like string. Most
                importantly it can be used for start-up completion
                notification.</p><p>If the <em class="parameter"><code>unset_environment</code></em>
                parameter is non-zero <code class="function">sd_notify()</code>
                will unset the <code class="varname">$NOTIFY_SOCKET</code>
                environment variable before returning (regardless
                whether the function call itself succeeded or
                not). Further calls to
                <code class="function">sd_notify()</code> will then fail, but
                the variable is no longer inherited by child
                processes.</p><p>The <em class="parameter"><code>state</code></em> parameter
                should contain an newline-separated list of variable
                assignments, similar in style to an environment
                block. A trailing newline is implied if none is
                specified. The string may contain any kind of variable
                assignments, but the following shall be considered
                well-known:</p><div class="variablelist"><dl><dt><span class="term">READY=1</span></dt><dd><p>Tells the init system
                                that daemon startup is finished. This
                                is only used by systemd if the service
                                definition file has Type=notify
                                set. The passed argument is a boolean
                                "1" or "0". Since there is little
                                value in signalling non-readiness, the
                                only value daemons should send is
                                "READY=1".</p></dd><dt><span class="term">STATUS=...</span></dt><dd><p>Passes a single-line
                                status string back to the init system
                                that describes the daemon state. This
                                is free-form and can be used for
                                various purposes: general state
                                feedback, fsck-like programs could
                                pass completion percentages and
                                failing programs could pass a human
                                readable error message. Example:
                                "STATUS=Completed 66% of file system
                                check..."</p></dd><dt><span class="term">ERRNO=...</span></dt><dd><p>If a daemon fails, the
                                errno-style error code, formatted as
                                string. Example: "ERRNO=2" for
                                ENOENT.</p></dd><dt><span class="term">BUSERROR=...</span></dt><dd><p>If a daemon fails, the
                                D-Bus error-style error code. Example:
                                "BUSERROR=org.freedesktop.DBus.Error.TimedOut"</p></dd><dt><span class="term">MAINPID=...</span></dt><dd><p>The main pid of the
                                daemon, in case the init system did
                                not fork off the process
                                itself. Example:
                                "MAINPID=4711"</p></dd></dl></div><p>It is recommended to prefix variable names that
                are not shown in the list above with
                <code class="varname">X_</code> to avoid namespace
                clashes.</p><p>Note that systemd will accept status data sent
                from a daemon only if the
                <code class="varname">NotifyAccess=</code> option is correctly
                set in the service definition file. See
                <span class="citerefentry"><span class="refentrytitle">systemd.service</span>(5)</span>
                for details.</p><p><code class="function">sd_notifyf()</code> is similar to
                <code class="function">sd_notifyf()</code> but takes a
                <code class="function">printf()</code>-like format string plus
                arguments.</p></div><div class="refsect1" title="Return Value"><a id="id513051"/><h2>Return Value</h2><p>On failure, these calls return a negative
                errno-style error code. If
                <code class="varname">$NOTIFY_SOCKET</code> was not set and
                hence no status data could be sent, 0 is returned. If
                the status was sent these functions return with a
                positive return value. In order to support both, init
                systems that implement this scheme and those which
                don't, it is generally recommended to ignore the return
                value of this call.</p></div><div class="refsect1" title="Notes"><a id="id513069"/><h2>Notes</h2><p>These functions are provided by the reference
                implementation of APIs for new-style daemons and
                distributed with the systemd package. The algorithms
                they implement are simple, and can easily be
                reimplemented in daemons if it is important to support
                this interface without using the reference
                implementation.</p><p>Internally, these functions send a single
                datagram with the state string as payload to the
                AF_UNIX socket referenced in the
                <code class="varname">$NOTIFY_SOCKET</code> environment
                variable. If the first character of
                <code class="varname">$NOTIFY_SOCKET</code> is @ the string is
                understood as Linux abstract namespace socket. The
                datagram is accompanied by the process credentials of
                the sending daemon, using SCM_CREDENTIALS.</p><p>For details about the algorithm check the
                liberally licensed reference implementation sources:
                <a class="ulink" href="http://cgit.freedesktop.org/systemd/tree/src/sd-daemon.c">http://cgit.freedesktop.org/systemd/tree/src/sd-daemon.c</a>
                resp. <a class="ulink" href="http://cgit.freedesktop.org/systemd/tree/src/sd-daemon.h">http://cgit.freedesktop.org/systemd/tree/src/sd-daemon.h</a></p><p><code class="function">sd_notify()</code> and
                <code class="function">sd_notifyf()</code> are implemented in
                the reference implementation's drop-in
                <code class="filename">sd-daemon.c</code> and
                <code class="filename">sd-daemon.h</code> files. It is
                recommended that applications consuming these APIs
                copy the implementation into their source tree. For
                more details about the reference implementation see
                <span class="citerefentry"><span class="refentrytitle">sd_daemon</span>(7)</span></p><p>If -DDISABLE_SYSTEMD is set during compilation
                this function will always return 0 and otherwise
                become a NOP.</p></div><div class="refsect1" title="Environment"><a id="id513211"/><h2>Environment</h2><div class="variablelist"><dl><dt><span class="term"><code class="varname">$NOTIFY_SOCKET</code></span></dt><dd><p>Set by the init system
                                for supervised processes for status
                                and start-up completion
                                notification. This environment variable
                                specifies the socket
                                <code class="function">sd_notify()</code> talks
                                to. See above for details.</p></dd></dl></div></div><div class="refsect1" title="Examples"><a id="id513241"/><h2>Examples</h2><div class="example"><a id="id513247"/><p class="title"><strong>Example 1. Start-up Notification</strong></p><div class="example-contents"><p>When a daemon finished starting up, it
                        might issue the following call to notify
                        the init system:</p><pre class="programlisting">sd_notify(0, "READY=1");</pre></div></div><br class="example-break"/><div class="example"><a id="id513264"/><p class="title"><strong>Example 2. Extended Start-up Notification</strong></p><div class="example-contents"><p>A daemon could send the following after
                        completing initialization:</p><pre class="programlisting">sd_notifyf(0, "READY=1\n"
              "STATUS=Processing requests...\n"
              "MAINPID=%lu",
              (unsigned long) getpid());</pre></div></div><br class="example-break"/><div class="example"><a id="id513282"/><p class="title"><strong>Example 3. Error Cause Notification</strong></p><div class="example-contents"><p>A daemon could send the following shortly before exiting, on failure</p><pre class="programlisting">sd_notifyf(0, "STATUS=Failed to start up: %s\n"
              "ERRNO=%i",
              strerror(errno),
              errno);</pre></div></div><br class="example-break"/></div><div class="refsect1" title="See Also"><a id="id513299"/><h2>See Also</h2><p>
                        <span class="citerefentry"><span class="refentrytitle">systemd</span>(1)</span>,
                        <span class="citerefentry"><span class="refentrytitle">sd_daemon</span>(7)</span>,
                        <span class="citerefentry"><span class="refentrytitle">daemon</span>(7)</span>,
                        <span class="citerefentry"><span class="refentrytitle">systemd.service</span>(5)</span>
                </p></div></div></body></html>
